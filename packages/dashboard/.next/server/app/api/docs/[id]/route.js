"use strict";(()=>{var e={};e.id=626,e.ids=[626],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},8531:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>j,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>d,PUT:()=>c});var i=r(2711),a=r(8380),n=r(3023),o=r(5098),u=r(4835);async function d(e,{params:t}){let{id:r}=await t,s=e.nextUrl.searchParams.get("path");if(!s)return o.NextResponse.json({error:"Path parameter is required"},{status:400});try{let e=await (0,u.hk)(s,r);if(!e)return o.NextResponse.json({error:"Document not found"},{status:404});return o.NextResponse.json({item:e})}catch(e){return console.error("Failed to get doc:",e),o.NextResponse.json({error:"Failed to get document"},{status:500})}}async function c(e,{params:t}){let{id:r}=await t;try{let{path:t,updates:s}=await e.json();if(!t)return o.NextResponse.json({error:"Path is required"},{status:400});s.content&&(s.humanEdited=!0);let i=await (0,u.cE)(t,r,s);if(!i)return o.NextResponse.json({error:"Document not found"},{status:404});return await (0,u.UZ)(t,i),o.NextResponse.json({item:i})}catch(e){return console.error("Failed to update doc:",e),o.NextResponse.json({error:"Failed to update document"},{status:500})}}async function p(e,{params:t}){let{id:r}=await t,s=e.nextUrl.searchParams.get("path");if(!s)return o.NextResponse.json({error:"Path parameter is required"},{status:400});try{if(!await (0,u.B7)(s,r))return o.NextResponse.json({error:"Document not found"},{status:404});return o.NextResponse.json({success:!0})}catch(e){return console.error("Failed to delete doc:",e),o.NextResponse.json({error:"Failed to delete document"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/docs/[id]/route",pathname:"/api/docs/[id]",filename:"route",bundlePath:"app/api/docs/[id]/route"},resolvedPagePath:"/Users/assistant/Github/kodex/packages/dashboard/app/api/docs/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:w}=l,x="/api/docs/[id]/route";function j(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},4835:(e,t,r)=>{r.d(t,{B7:()=>f,UZ:()=>w,cE:()=>m,hk:()=>l,zj:()=>c});var s=r(2048),i=r(5315),a=r.n(i);let n="items.json",o="gaps.json";function u(e){return a().join(e,".kodex")}async function d(e){let t=u(e);await s.promises.mkdir(t,{recursive:!0}),await s.promises.mkdir(a().join(t,"docs"),{recursive:!0})}async function c(e){let t=u(e),r=[],i=[];try{let e=a().join(t,n),i=await s.promises.readFile(e,"utf-8");r=JSON.parse(i).items||[]}catch{}try{let e=a().join(t,o),r=await s.promises.readFile(e,"utf-8");i=JSON.parse(r).gaps||[]}catch{}return{items:r,gaps:i,meta:{name:"Knowledge Base",version:"1.0.0"}}}async function p(e,t){await d(e);let r=u(e),i=a().join(r,n);await s.promises.writeFile(i,JSON.stringify({items:t.items,meta:t.meta},null,2),"utf-8");let c=a().join(r,o);await s.promises.writeFile(c,JSON.stringify({gaps:t.gaps},null,2),"utf-8")}async function l(e,t){return(await c(e)).items.find(e=>e.id===t)||null}async function m(e,t,r){let s=await c(e),i=s.items.findIndex(e=>e.id===t);return -1===i?null:(s.items[i]={...s.items[i],...r,lastEditedAt:new Date().toISOString()},await p(e,s),s.items[i])}async function f(e,t){let r=await c(e),s=r.items.findIndex(e=>e.id===t);return -1!==s&&(r.items.splice(s,1),await p(e,r),!0)}async function w(e,t){await d(e);let r=a().join(u(e),"docs"),i=t.topic.split(".")[0],n=a().join(r,i);await s.promises.mkdir(n,{recursive:!0});let o=`${t.id}.md`,c=a().join(n,o),p=`---
id: ${t.id}
title: ${t.title}
topic: ${t.topic}
pages: ${JSON.stringify(t.pages)}
status: ${t.status}
---

`;await s.promises.writeFile(c,p+t.content,"utf-8")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[991,189],()=>r(8531));module.exports=s})();